# PIXELZX POS EVM Chain Development Dockerfile
# Hot reload 지원 개발 환경

FROM golang:1.21-alpine

# Install development dependencies
RUN apk add --no-cache \
    git \
    make \
    gcc \
    musl-dev \
    bash \
    curl \
    jq \
    vim

# Install Air for hot reload
RUN go install github.com/cosmtrek/air@latest

# Set working directory
WORKDIR /app

# Copy go mod files
COPY go.mod go.sum ./

# Download dependencies
RUN go mod download

# Copy source code
COPY . .

# Build the binary for development
RUN make build

# Create app user
RUN addgroup -g 1001 -S pixelzx && \
    adduser -u 1001 -S pixelzx -G pixelzx

# Create data directories
RUN mkdir -p /app/data /app/keystore /app/logs && \
    chown -R pixelzx:pixelzx /app

# Switch to app user
USER pixelzx

# Expose ports
EXPOSE 8545 8546 30303 6060 40000

# Set environment variables
ENV PIXELZX_HOME=/app
ENV PIXELZX_CONFIG=/app/config.yaml
ENV PIXELZX_DATA_DIR=/app/data
ENV PIXELZX_DEV_MODE=true

# Development command with hot reload
CMD ["air", "-c", ".air.toml"]